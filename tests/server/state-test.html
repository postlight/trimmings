<!DOCTYPE html>
<html>
<head>
  <meta charset="utf8" />
  <title>State test</title>
</head>
<body>
  <button>A</button>
  <button>B</button>
  <button>C</button>
  <button>D</button>
  <div id="log"></div>
  <script>
    const update = () => {
      const { selection } = window.history.state
      console.log('ok', history.state)
      document.querySelector('#log').innerText = history.state.selection
    }

    document.addEventListener('click', (e) => {
      if (e.target.nodeName === 'BUTTON') {
        e.preventDefault()
        e.stopPropagation()
        const selection = e.target.innerText
        history.pushState({ selection }, null, `/${selection}`)
        update()
      }
    })

    window.addEventListener('popstate', update)

    history.replaceState({ selection: null }, null, location.href)
  </script>
</body>
</html>
